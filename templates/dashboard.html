<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EcoVerse ‚Äì From Sightings to Verified Action</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="{{url_for('static',filename='style.css' )}}" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>

<body class="bg-gray-100 text-gray-900">
  <header
    class="p-5 bg-gradient-to-r from-green-700 to-emerald-600 text-white text-center text-2xl sm:text-3xl font-extrabold shadow-md">
    üåç EcoVerse ‚Äì From Sightings to Verified Action
  </header>
  <main class="p-6 max-w-5xl mx-auto">
    <section id="dashboardSection" style="margin-bottom: 20px;" class="bg-white rounded-2xl shadow-md p-5 sm:p-6">
      <h2 class="text-xl font-bold mb-2">Impact Dashboard</h2>
      <canvas id="impactChart" width="200" height="100"></canvas>
    </section>
    <section id="metricsSection" class="p-4">
      <h2 class="text-xl font-bold mb-2">Impact Metrics</h2>
      <canvas id="metricsChart" width="200" height="100"></canvas>
      <div class="mt-4">
        <p class="font-semibold">Resolution Rate</p>
        <div class="w-full bg-gray-200 rounded-full h-4">
          <div id="resolutionBar" class="bg-green-500 h-4 rounded-full" style="width: 0%"></div>
        </div>
      </div>
    </section>
    <section id="heatmapSection" class="bg-white rounded-2xl shadow-md p-5 sm:p-6 mt-6">
      <h2 class="text-xl font-bold mb-2">Regional Issue Heatmap</h2>
      <canvas id="heatmapChart"></canvas>
    </section>

    <!-- Add these CDN scripts (after Chart.js) -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@1.3.0/dist/chartjs-chart-matrix.min.js"></script>

  </main>
  <script src="{{url_for('static', filename='script.js')}}"></script>
  <script>
    async function loadImpactChart() {
      const res = await fetch("/api/dashboard/impact");
      const data = await res.json();

      const ctx = document.getElementById("impactChart").getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: Object.keys(data),
          datasets: [{
            label: "Reports by Category",
            data: Object.values(data),
            backgroundColor: "rgba(34, 197, 94, 0.6)", // green
            borderColor: "rgba(22, 163, 74, 1)",
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    // Metrics Chart (Report Status)
    async function loadMetricsChart() {
      const res = await fetch("/api/dashboard/metrics");
      const data = await res.json();

      const ctx = document.getElementById("metricsChart").getContext("2d");
      new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: ["New", "Verified", "Resolved"],
          datasets: [{
            data: [data.new, data.verified, data.resolved],
            backgroundColor: ["#facc15", "#3b82f6", "#22c55e"],
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: "bottom" }
          }
        }
      });
    }

    // Resolution Rate Progress Bar
    async function loadResolutionRate() {
      const res = await fetch("/api/dashboard/resolution-rate");
      const data = await res.json();

      const bar = document.getElementById("resolutionBar");
      bar.style.width = `${data.resolution_rate}%`;
      bar.style.padding = '5px'
      bar.innerText = `${Math.round(data.resolution_rate)}%`;
      bar.style.height = '40px';
    }


    window.onload = () => {
      loadImpactChart();
      loadMetricsChart();
      loadResolutionRate();
    };
  </script>
</body>

</html>